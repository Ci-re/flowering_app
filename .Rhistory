accept = c(".csv", "text/csv", "text/comma-seperated-values", "text/plain" )),
hr(),
uiOutput("submit")
),
# Show a plot of the generated distribution
mainPanel(
span(textOutput("resHeader"),style="font-size: 20px; font-weight: bold; color: blue"),
DT::dataTableOutput("finalResult"),
span(uiOutput("button1"),uiOutput("button2")),
textOutput("filepath"),
)
)
)
)
# Define server logic required to draw a histogram
server <- function(input, output, session) {
###### ACTIVATE THE SHINY ALERT POPUP
observeEvent(input$Format, {
shinyalert("Requirements", "Data file should be in .csv and should contain the following variables: \n
Weekly data as weekly_data,\n unique id as unique_id, \n Height as height, \n Forked as forked, \n
Damage as damage, \n ml STS previous week as ml_STS_previous_week, \n  nM BA previous week as mM_BA_previous_week",
type = "info")
})
###### DOWNLOAD OPTION 1 FOR CSV
output$button1 <- renderUI({
req(input$getData)
actionButton("download", "Get CSV")
})
###### DOWNLOAD OPTION 2 FOR EXCEL
output$button2 <- renderUI({
req(input$getData)
return(actionButton("download2", "Get EXCEL"))
})
##### INPUT OPTION FOR LOCATION, A SELECTBOX
output$selectLocation <- renderUI({
selectInput("selectedLocation", "Please select a location",
choices = c("Ibadan", "Ubiaja", "Others"), selected = "Ibadan")
})
###### INPUT OPTIONS FOR UNAVAILABLE SELECTED LOCATION
output$locationInput <- renderUI({
req(input$selectedLocation)
if (!input$selectedLocation == 'Others') return(NULL) else {
textInput("enterLocation", "Please enter your location below")
}
})
####### SUBMIT BUTTON TO GET YOUR DATA
output$submit <- renderUI({
req(input$selectedLocation)
if((input$selectedLocation == 'Others' && input$enterLocation != "" && input$userName != "")
|| (input$selectedLocation != "Others" && input$userName != "") ){
actionButton("getData", "Submit")
} else {
return(NULL)
}
})
##### MAKE YOUR FILE INPUT DATA
df <- reactive({
file <- input$inputFile
ext <- tools::file_ext(file$datapath)
req(file)
validate(need(ext == c("csv", "xlsx", "xls"), "Please your data must be a csv file or an excel file"))
if(ext == "csv"){
#### READ CSV FILE
read_csv(file = file$datapath)
##### RENAME CSV AND WRITE TO GOOGLESHEETS
username <- input$userName
userLocation <- input$selectedLocation
csv_name <- paste0(Sys.Date(), "_",username,"_",userLocation,"_PGR_Treatments_input",".csv",sep="")
write_csv(x = file$datapath, file = csv_name)
print(csv_name)
} else {
##### READ EXCEL FILE
read_excel(file$datapath)
username <- input$userName
userLocation <- input$selectedLocation
xls_name <- paste0(Sys.Date(), "_",username,"_",userLocation,"_PGR_Treatments_input",".xls",sep="")
WriteXLS::WriteXLS(file$datapath, ExcelFileName = xls_name, row.names = FALSE)
print(xls_name)
}
})
###### RENDER THE RESULT TEXT ON THE DATA TABLE
output$resHeader <- renderText({
req(input$getData)
"Result"
})
###### RENDER TABLE FOR THE RESULT
output$finalResult <- DT::renderDataTable({
req(input$getData)
weekly_data  <- df()
column_names <- colnames(weekly_data)
selected_column_names <- c("unique_id", "height", "forked", "damage", "ml_STS_previous_week", "nM_BA_previous_week")
valid <- selected_column_names %in% column_names
as.list(valid)
valid
if(FALSE %in% valid){
shinyalert("Requirements", "Please we can't find some column names in your data, \n Please download a template and use carefully",
type = "info")
return(NULL)
}
selections <- select(weekly_data,unique_id,height,forked,damage,ml_STS_previous_week,
mM_BA_previous_week) %>%
mutate(weekly_data,BA_last_week=if_else(mM_BA_previous_week>0,"y","n")) %>%
mutate(weekly_data,STS_last_week=if_else(ml_STS_previous_week>0,"y","n")) %>%
select(unique_id,height,forked,damage,BA_last_week,STS_last_week)
###### CALCULATE TREATMENTS AFTER SELECTED COLUMNS
treatments <- selections %>%
mutate(start_PGR = if_else(height < 60 & forked == "n", "n",
if_else(height > 45 & forked == "y", "y",
if_else(height > 60, "y", "NA" )))) %>%
mutate(prune_ok = if_else(BA_last_week=="y","y","n")) %>%
mutate(base_mL_STS = if_else(height %in% 0:45,"0",
if_else(height %in% 46:60, "1.25",
if_else(height %in% 61:80, "2.5",
if_else(height %in% 81:100, "3.5",
if_else(height %in% 101:120, "4.5",
if_else(height %in% 121:140, "5.5",
if_else(height %in% 141:160, "6.5",
if_else(height %in% 161:180, "7.5",
if_else(height %in% 181:200, "8.5",
"10")))))))))) %>%
mutate(damage_reduction_factor = if_else(damage == 0, "1",
if_else(damage == 1, "1",
if_else(damage == 2, "0.5",
if_else(damage == 3, "0", "NA" ))))) %>%
mutate(base_mM_BA = if_else(start_PGR == "y", "0.5",
if_else (start_PGR == "n", "0", "NA" ))) %>%
mutate(start_PGR_factor = if_else(start_PGR == "y", 1,0)) %>%
mutate(STS_last_week_factor = if_else(STS_last_week == "y", 0,1))
#### check treatments for NA
NA_treatment <- treatments %>%
filter_all(any_vars(.=="NA"))
##### DATATABLE RENDERER
DT::datatable(data.frame(treatments), options = list(scrollX = TRUE))
})
}
# Run the application
shinyApp(ui = ui, server = server)
library(tidyverse)
library(readxl)
library(shiny)
library(shinyjs)
library(readr)
library(DT)
library(shinyalert)
# Define UI for application that draws a histogram
ui <- shinyUI(fluidPage(tags$head(tags$style(HTML('#Format'))),
# Application title
titlePanel(h1(strong("FLOWERING APP"), style="color:lightblue")),
hr(), br(), br(),
sidebarLayout(
sidebarPanel(
useShinyalert(),
actionButton("Format", "File Format"),
br(), br(),
textInput("userName", "Please enter your name"),
div(style="display:inline-block",uiOutput("selectLocation", label = "Select a location"), style="float:right"),
uiOutput("locationInput"),
fileInput("inputFile", "Choose your flowering data file",multiple = FALSE,
accept = c(".csv", "text/csv", "text/comma-seperated-values", "text/plain" )),
hr(),
uiOutput("submit")
),
# Show a plot of the generated distribution
mainPanel(
span(textOutput("resHeader"),style="font-size: 20px; font-weight: bold; color: blue"),
DT::dataTableOutput("finalResult"),
span(uiOutput("button1"),uiOutput("button2")),
textOutput("filepath"),
)
)
)
)
# Define server logic required to draw a histogram
server <- function(input, output, session) {
###### ACTIVATE THE SHINY ALERT POPUP
observeEvent(input$Format, {
shinyalert("Requirements", "Data file should be in .csv and should contain the following variables: \n
Weekly data as weekly_data,\n unique id as unique_id, \n Height as height, \n Forked as forked, \n
Damage as damage, \n ml STS previous week as ml_STS_previous_week, \n  nM BA previous week as mM_BA_previous_week",
type = "info")
})
###### DOWNLOAD OPTION 1 FOR CSV
output$button1 <- renderUI({
req(input$getData)
actionButton("download", "Get CSV")
})
###### DOWNLOAD OPTION 2 FOR EXCEL
output$button2 <- renderUI({
req(input$getData)
return(actionButton("download2", "Get EXCEL"))
})
##### INPUT OPTION FOR LOCATION, A SELECTBOX
output$selectLocation <- renderUI({
selectInput("selectedLocation", "Please select a location",
choices = c("Ibadan", "Ubiaja", "Others"), selected = "Ibadan")
})
###### INPUT OPTIONS FOR UNAVAILABLE SELECTED LOCATION
output$locationInput <- renderUI({
req(input$selectedLocation)
if (!input$selectedLocation == 'Others') return(NULL) else {
textInput("enterLocation", "Please enter your location below")
}
})
####### SUBMIT BUTTON TO GET YOUR DATA
output$submit <- renderUI({
req(input$selectedLocation)
if((input$selectedLocation == 'Others' && input$enterLocation != "" && input$userName != "")
|| (input$selectedLocation != "Others" && input$userName != "") ){
actionButton("getData", "Submit")
} else {
return(NULL)
}
})
##### MAKE YOUR FILE INPUT DATA
df <- reactive({
file <- input$inputFile
ext <- tools::file_ext(file$datapath)
req(file)
validate(need(ext == c("csv", "xlsx", "xls"), "Please your data must be a csv file or an excel file"))
if(ext == "csv"){
#### READ CSV FILE
read_csv(file = file$datapath)
##### RENAME CSV AND WRITE TO GOOGLESHEETS
username <- input$userName
userLocation <- input$selectedLocation
csv_name <- paste0(Sys.Date(), "_",username,"_",userLocation,"_PGR_Treatments_input",".csv",sep="")
write_csv(x = data.frame(file$datapath), file = csv_name)
print(csv_name)
} else {
##### READ EXCEL FILE
read_excel(file$datapath)
username <- input$userName
userLocation <- input$selectedLocation
xls_name <- paste0(Sys.Date(), "_",username,"_",userLocation,"_PGR_Treatments_input",".xls",sep="")
WriteXLS::WriteXLS(data.frame(file$datapath), ExcelFileName = xls_name, row.names = FALSE)
print(xls_name)
}
})
###### RENDER THE RESULT TEXT ON THE DATA TABLE
output$resHeader <- renderText({
req(input$getData)
"Result"
})
###### RENDER TABLE FOR THE RESULT
output$finalResult <- DT::renderDataTable({
req(input$getData)
weekly_data  <- df()
column_names <- colnames(weekly_data)
selected_column_names <- c("unique_id", "height", "forked", "damage", "ml_STS_previous_week", "nM_BA_previous_week")
valid <- selected_column_names %in% column_names
as.list(valid)
valid
if(FALSE %in% valid){
shinyalert("Requirements", "Please we can't find some column names in your data, \n Please download a template and use carefully",
type = "info")
return(NULL)
}
selections <- select(weekly_data,unique_id,height,forked,damage,ml_STS_previous_week,
mM_BA_previous_week) %>%
mutate(weekly_data,BA_last_week=if_else(mM_BA_previous_week>0,"y","n")) %>%
mutate(weekly_data,STS_last_week=if_else(ml_STS_previous_week>0,"y","n")) %>%
select(unique_id,height,forked,damage,BA_last_week,STS_last_week)
###### CALCULATE TREATMENTS AFTER SELECTED COLUMNS
treatments <- selections %>%
mutate(start_PGR = if_else(height < 60 & forked == "n", "n",
if_else(height > 45 & forked == "y", "y",
if_else(height > 60, "y", "NA" )))) %>%
mutate(prune_ok = if_else(BA_last_week=="y","y","n")) %>%
mutate(base_mL_STS = if_else(height %in% 0:45,"0",
if_else(height %in% 46:60, "1.25",
if_else(height %in% 61:80, "2.5",
if_else(height %in% 81:100, "3.5",
if_else(height %in% 101:120, "4.5",
if_else(height %in% 121:140, "5.5",
if_else(height %in% 141:160, "6.5",
if_else(height %in% 161:180, "7.5",
if_else(height %in% 181:200, "8.5",
"10")))))))))) %>%
mutate(damage_reduction_factor = if_else(damage == 0, "1",
if_else(damage == 1, "1",
if_else(damage == 2, "0.5",
if_else(damage == 3, "0", "NA" ))))) %>%
mutate(base_mM_BA = if_else(start_PGR == "y", "0.5",
if_else (start_PGR == "n", "0", "NA" ))) %>%
mutate(start_PGR_factor = if_else(start_PGR == "y", 1,0)) %>%
mutate(STS_last_week_factor = if_else(STS_last_week == "y", 0,1))
#### check treatments for NA
NA_treatment <- treatments %>%
filter_all(any_vars(.=="NA"))
##### DATATABLE RENDERER
DT::datatable(data.frame(treatments), options = list(scrollX = TRUE))
})
}
# Run the application
shinyApp(ui = ui, server = server)
getwd()
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
FALSE %in% valid
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
library(tidyverse)
library(readxl)
library(shiny)
library(shinyjs)
library(readr)
library(DT)
library(shinyalert)
# Define UI for application that draws a histogram
ui <- shinyUI(fluidPage(tags$head(tags$style(HTML('#Format'))),
# Application title
titlePanel(h1(strong("FLOWERING APP"), style="color:lightblue")),
hr(), br(), br(),
sidebarLayout(
sidebarPanel(
useShinyalert(),
actionButton("Format", "File Format"),
br(), br(),
textInput("userName", "Please enter your name"),
div(style="display:inline-block",uiOutput("selectLocation", label = "Select a location"), style="float:right"),
uiOutput("locationInput"),
fileInput("inputFile", "Choose your flowering data file",multiple = FALSE,
accept = c(".csv", "text/csv", "text/comma-seperated-values", "text/plain" )),
hr(),
uiOutput("submit")
),
# Show a plot of the generated distribution
mainPanel(
span(textOutput("resHeader"),style="font-size: 20px; font-weight: bold; color: blue"),
DT::dataTableOutput("finalResult"),
span(uiOutput("button1"),uiOutput("button2")),
textOutput("filepath"),
)
)
)
)
# Define server logic required to draw a histogram
server <- function(input, output, session) {
###### ACTIVATE THE SHINY ALERT POPUP
observeEvent(input$Format, {
shinyalert("Requirements", "Data file should be in .csv and should contain the following variables: \n
Weekly data as weekly_data,\n unique id as unique_id, \n Height as height, \n Forked as forked, \n
Damage as damage, \n ml STS previous week as ml_STS_previous_week, \n  nM BA previous week as mM_BA_previous_week",
type = "info")
})
###### DOWNLOAD OPTION 1 FOR CSV
output$button1 <- renderUI({
req(input$getData)
actionButton("download", "Get CSV")
})
###### DOWNLOAD OPTION 2 FOR EXCEL
output$button2 <- renderUI({
req(input$getData)
return(actionButton("download2", "Get EXCEL"))
})
##### INPUT OPTION FOR LOCATION, A SELECTBOX
output$selectLocation <- renderUI({
selectInput("selectedLocation", "Please select a location",
choices = c("Ibadan", "Ubiaja", "Others"), selected = "Ibadan")
})
###### INPUT OPTIONS FOR UNAVAILABLE SELECTED LOCATION
output$locationInput <- renderUI({
req(input$selectedLocation)
if (!input$selectedLocation == 'Others') return(NULL) else {
textInput("enterLocation", "Please enter your location below")
}
})
####### SUBMIT BUTTON TO GET YOUR DATA
output$submit <- renderUI({
req(input$selectedLocation)
if((input$selectedLocation == 'Others' && input$enterLocation != "" && input$userName != "")
|| (input$selectedLocation != "Others" && input$userName != "") ){
actionButton("getData", "Submit")
} else {
return(NULL)
}
})
##### MAKE YOUR FILE INPUT DATA
df <- reactive({
file <- input$inputFile
ext <- tools::file_ext(file$datapath)
req(file)
validate(need(ext == c("csv", "xlsx", "xls"), "Please your data must be a csv file or an excel file"))
if(ext == "csv"){
#### READ CSV FILE
read_csv(file = file$datapath)
##### RENAME CSV AND WRITE TO GOOGLESHEETS
username <- input$userName
} else {
##### READ EXCEL FILE
read_excel(file$datapath)
}
})
###### RENDER THE RESULT TEXT ON THE DATA TABLE
output$resHeader <- renderText({
req(input$getData)
"Result"
})
###### RENDER TABLE FOR THE RESULT
output$finalResult <- DT::renderDataTable({
req(input$getData)
weekly_data  <- df()
# column_names <- colnames(weekly_data)
#selected_column_names <- c("unique_id", "height", "forked", "damage", "ml_STS_previous_week", "nM_BA_previous_week")
#valid <- selected_column_names %in% column_names
#as.list(valid)
#valid
#if(FALSE %in% valid){
# shinyalert("Requirements", "Please we can't find some column names in your data, \n Please download a template and use carefully",
#           type = "info")
#  return(NULL)
#  }
selections <- select(weekly_data,unique_id,height,forked,damage,ml_STS_previous_week,
mM_BA_previous_week) %>%
mutate(weekly_data,BA_last_week=if_else(mM_BA_previous_week>0,"y","n")) %>%
mutate(weekly_data,STS_last_week=if_else(ml_STS_previous_week>0,"y","n")) %>%
select(unique_id,height,forked,damage,BA_last_week,STS_last_week)
###### CALCULATE TREATMENTS AFTER SELECTED COLUMNS
treatments <- selections %>%
mutate(start_PGR = if_else(height < 60 & forked == "n", "n",
if_else(height > 45 & forked == "y", "y",
if_else(height > 60, "y", "NA" )))) %>%
mutate(prune_ok = if_else(BA_last_week=="y","y","n")) %>%
mutate(base_mL_STS = if_else(height %in% 0:45,"0",
if_else(height %in% 46:60, "1.25",
if_else(height %in% 61:80, "2.5",
if_else(height %in% 81:100, "3.5",
if_else(height %in% 101:120, "4.5",
if_else(height %in% 121:140, "5.5",
if_else(height %in% 141:160, "6.5",
if_else(height %in% 161:180, "7.5",
if_else(height %in% 181:200, "8.5",
"10")))))))))) %>%
mutate(damage_reduction_factor = if_else(damage == 0, "1",
if_else(damage == 1, "1",
if_else(damage == 2, "0.5",
if_else(damage == 3, "0", "NA" ))))) %>%
mutate(base_mM_BA = if_else(start_PGR == "y", "0.5",
if_else (start_PGR == "n", "0", "NA" ))) %>%
mutate(start_PGR_factor = if_else(start_PGR == "y", 1,0)) %>%
mutate(STS_last_week_factor = if_else(STS_last_week == "y", 0,1))
#### check treatments for NA
NA_treatment <- treatments %>%
filter_all(any_vars(.=="NA"))
userLocation <- input$selectedLocation
csv_name <- paste0(Sys.Date(), "_",username,"_",userLocation,"_PGR_Treatments_input",".csv",sep="")
write.csv(x = data.frame(file$datapath), file = csv_name)
print(csv_name)
##### DATATABLE RENDERER
DT::datatable(data.frame(treatments), options = list(scrollX = TRUE))
})
}
# Run the application
shinyApp(ui = ui, server = server)
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
x <- colnames(mtcars)
w <- c( "mpg", "am", "gear")
const
valid <- w %in% x
valid
list(valid)
x
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
shiny::runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
runApp('Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app')
setwd("/home/cirec/Desktop/git_workspace/Exploratory-Data-Analysis/workspace/May/Flowering/Flowering_app")
getwd()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
